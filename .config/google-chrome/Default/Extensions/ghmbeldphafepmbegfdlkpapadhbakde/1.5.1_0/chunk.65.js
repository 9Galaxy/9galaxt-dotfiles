"use strict";(globalThis.webpackChunkproton_pass_extension=globalThis.webpackChunkproton_pass_extension||[]).push([[65],{8065:(e,t,r)=>{function decode_qp(e){return[e.replace(/=([0-9A-F][0-9A-F]|[ \t]*(\r\n|[\r\n]|$))/gi,(function(e,t){return 0==t.trim().length?"":String.fromCharCode(parseInt(t,16))})),""]}function decode_base64(e,t){let r=e.replace(/[^A-Za-z0-9+/=]/g,"");r=r.replace(/=+([A-Za-z0-9+/])/g,"$1");let s=r.length%4;return e=0!=s&&t?r.slice(-s):"",r=r.substring(0,r.length-s),r=r.replace(/(====)+$/g,""),[atob(r),e]}function stringToUint8Array(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function uint8ArrayToString(e){var t="";for(let r=0;r<e.length;r+=100)t+=String.fromCharCode.apply(void 0,e.subarray(r,r+100));return t}r.r(t),r.d(t,{parseMail:()=>parseMail});const s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];class UTF7TextDecoder{constructor(){this.collectInput="",this.decodeString=decodeUtf7}decode(e,t={}){let r=t.stream;return e&&(this.collectInput+=uint8ArrayToString(e)),r?"":this.decodeString(this.collectInput)}}class UTF7ImapTextDecoder extends UTF7TextDecoder{constructor(){super(),this.decodeString=decodeUtf7Imap}}function MimeTextDecoder(e,t){switch(e.toLowerCase()){case"utf-7":return new UTF7TextDecoder;case"utf-7-imap":return new UTF7ImapTextDecoder;case"cp932":return new TextDecoder("shift_jis",t);default:return new TextDecoder(e,t)}}function decodeFromUTF7(e){const t=stringToUint8Array(atob(e));let r="";for(let e=0,s=t.length;e<s;)r+=String.fromCharCode(t[e++]<<8|t[e++]);return r}const decodeUtf7=e=>e.replace(/\+([A-Za-z0-9/]*)-?/gi,((e,t)=>""===t?"+":decodeFromUTF7(t))),decodeUtf7Imap=e=>e.replace(/&([^-]*)-/g,((e,t)=>""===t?"&":decodeFromUTF7(t.replace(/,/g,"/"))));var a=new Map,n=new Map,i=new Map;function addHeader(e,t,r){var s=e.toLowerCase();a.set(s,t),n.set(s,r),i.set(s,e)}function parseAddress(e){let t=this;return e.reduce((function(e,r){return e.concat(t.parseAddressingHeader(r,!0))}),[])}function writeAddress(e){Array.isArray(e)||(e=[e]),this.addAddresses(e)}function parseParameterHeader(e,t,r){return this.parseParameterHeader(e[0],t,r)}function parseUnstructured(e){return this.decodeRFC2047Words(e[0])}function writeUnstructured(e){this.addUnstructured(e)}function parseMessageID(e){return this.decodeRFC2047Words(e[0])}function writeMessageID(e){this.addUnstructured(e)}function parseDate(e){return this.parseDateHeader(e[0])}function writeDate(e){this.addDate(e)}function preprocessMessageIDs(e){let t,r=/<[^>]*>/g,s=[];for(;null!==(t=r.exec(e));)s.push(t[0]);return s.join(" ")}addHeader("Bcc",parseAddress,writeAddress),addHeader("Cc",parseAddress,writeAddress),addHeader("From",parseAddress,writeAddress),addHeader("Reply-To",parseAddress,writeAddress),addHeader("Resent-Bcc",parseAddress,writeAddress),addHeader("Resent-Cc",parseAddress,writeAddress),addHeader("Resent-From",parseAddress,writeAddress),addHeader("Resent-Reply-To",parseAddress,writeAddress),addHeader("Resent-Sender",parseAddress,writeAddress),addHeader("Resent-To",parseAddress,writeAddress),addHeader("Sender",parseAddress,writeAddress),addHeader("To",parseAddress,writeAddress),addHeader("Approved",parseAddress,writeAddress),addHeader("Disposition-Notification-To",parseAddress,writeAddress),addHeader("Delivered-To",parseAddress,writeAddress),addHeader("Return-Receipt-To",parseAddress,writeAddress),addHeader("Mail-Reply-To",parseAddress,writeAddress),addHeader("Mail-Followup-To",parseAddress,writeAddress),a.set("Content-Type",(function parseContentType(e){let t=parseParameterHeader.call(this,e,!1,!1),r=t.preSemi.split("/");2!=r.length&&(t=new Map,r=["text","plain"]);let s=r[0].toLowerCase(),a=r[1].toLowerCase(),n=s+"/"+a,i=new Map;return i.mediatype=s,i.subtype=a,i.type=n,t.forEach((function(e,t){i.set(t.toLowerCase(),e)})),i})),addHeader("Comments",parseUnstructured,writeUnstructured),addHeader("Keywords",parseUnstructured,writeUnstructured),addHeader("Subject",parseUnstructured,writeUnstructured),addHeader("MIME-Version",parseUnstructured,writeUnstructured),addHeader("Content-Description",parseUnstructured,writeUnstructured),addHeader("User-Agent",parseUnstructured,writeUnstructured),addHeader("Date",parseDate,writeDate),addHeader("Resent-Date",parseDate,writeDate),addHeader("Expires",parseDate,writeDate),addHeader("Injection-Date",parseDate,writeDate),addHeader("NNTP-Posting-Date",parseDate,writeDate),addHeader("Message-ID",parseMessageID,writeMessageID),addHeader("Resent-Message-ID",parseMessageID,writeMessageID),a.set("Content-Transfer-Encoding",(function(e){return e[0].toLowerCase()})),n.set("Content-Transfer-Encoding",writeUnstructured),a.set("References",preprocessMessageIDs),a.set("In-Reply-To",preprocessMessageIDs);const o={};function cleanToken(e){return e=(e=(e=(e=(e=(e=e.replace(/[\xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/g," ")).replace(/[\u034F\u17B4\u17B5\u180B-\u180D\uFE00-\uFE0F]/g,"")).replace(/\uDB40[\uDD00-\uDDEF]/g,"")).replace(/(?![\t\n\r])[\0-\x1F\x7F-\x9F]/g,"")).replace(/(?:[\xAD\u061C\u06DD\u070F\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC38]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F])/g," ")).replace(/\u2800/g," ")}function getHeaderTokens(e,t,r){let s,a=[];function Token(e){this.token=e.replace(/\\(.?)/g,"$1")}Token.prototype.toString=function(){return this.token};let n,i=0,o=e.length;for(let d=0;d<o;d++){let o=e[d];if("\\"==o){d++;continue}if(void 0!==n){if(o==n&&'"'==o){let t=e.slice(s+1,d);r.rfc2047&&(t=decodeRFC2047Words(t)),a.push(new Token(t)),n=void 0,s=void 0}else o==n&&"]"==o&&(a.push(new Token(e.slice(s,d+1))),n=void 0,s=void 0);continue}if(r.rfc2047&&"="==o&&d+1<e.length&&"?"==e[d+1]){let t=/([ \t\r\n]*=\?[^?]*\?[BbQq]\?[^?]*\?=)+/.exec(e.slice(d));if(null!==t){void 0!==s&&(a.push(new Token(e.slice(s,d))),s=void 0);let r=t[0].length,n=decodeRFC2047Words(e.slice(d,d+r));a.push({toString:()=>n}),d+=r-1;continue}}let c=!1,h=!1,u=!1;" \t\r\n".includes(o)?c=!0:0==i&&t.includes(o)?(c=!0,u=!0):r.qstring&&'"'==o?(c=!0,h=!0,n=o):r.dliteral&&"["==o?(c=!0,h=!0,n="]"):r.comments&&"("==o?(i++,1==i?(c=!0,u=!0):h=!0):r.comments&&")"==o?(i>0&&i--,0==i?(c=!0,u=!0):h=!0):h=!0,c&&void 0!==s&&(a.push(new Token(e.slice(s,d))),s=void 0),u&&a.push(o),h&&void 0===s&&(s=d)}return void 0!==s&&('"'==n?a.push(new Token(e.slice(s+1))):a.push(new Token(e.slice(s)))),a}function decodeRFC2047Words(e){let t,r="";function decode2047Token(e,s){let a=e.split("?");if(5!=a.length||"="!=a[4])return!1;let n,i=a[1].split("*",1)[0],o=a[2],d=a[3];if("B"==o||"b"==o){if(/[^ A-Za-z0-9+/=]/.exec(d))return!1;n=decode_base64(d,!1)[0]}else{if("Q"!=o&&"q"!=o)return!1;n=decode_qp(d.replace(/_/g," "))[0]}let c=n;n=stringToUint8Array(n);var h="";if(i!=r&&t&&(h+=t.decode(),t=null),r=i,!t)try{t=new MimeTextDecoder(i,{fatal:!1})}catch(e){return!1}let u;return u=s||"ISO-2022-JP"==i.toUpperCase()&&c.endsWith("")?{stream:!1}:{stream:!0},h+t.decode(n,u)}let s=e.split(/(=\?[^?]*\?[BQbq]\?[^?]*\?=)/),a=-1;for(let e=0;e<s.length;e++)"=?"==s[e].substring(0,2)&&(a=e);for(let e=0;e<s.length;e++){if("=?"==s[e].substring(0,2)){let t=decode2047Token(s[e],e==a);if(!1!==t){s[e]=t;continue}}else if(/^[ \t\r\n]*$/.exec(s[e])){s[e]="";continue}r="",t&&(s[e]=t.decode()+s[e],t=null)}return s.join("")}function decode2231Value(e){let t=e.indexOf("'"),r=t>=0?e.indexOf("'",t+1):-1,s=t>=0?e.substring(0,t):"",a=stringToUint8Array(e=e.substring(Math.max(t,r)+1));return new MimeTextDecoder(s,{fatal:!0}).decode(a,{stream:!1})}var d={UT:"+0000",GMT:"+0000",EST:"-0500",EDT:"-0400",CST:"-0600",CDT:"-0500",MST:"-0700",MDT:"-0600",PST:"-0800",PDT:"-0700",AST:"-0400",NST:"-0330",BST:"+0100",MET:"+0100",EET:"+0200",JST:"+0900"};var c=new Map,h=new Set;for(let e of a)addStructuredDecoder(e[0],e[1]),h.add(e[0].toLowerCase());function addStructuredDecoder(e,t){let r=e.toLowerCase();if(h.has(r))throw new Error("Cannot override header: "+e);c.set(r,t),i.has(r)||i.set(r,e)}o.addStructuredDecoder=addStructuredDecoder,o.convert8BitHeader=function convert8BitHeader(e,t){if(/[\x80-\xff]/.exec(e)){let r=stringToUint8Array(e),s=new MimeTextDecoder("utf-8",{fatal:t&&!t.toLowerCase().startsWith("utf")});try{e=s.decode(r)}catch(s){try{e=new MimeTextDecoder(t,{fatal:!1}).decode(r)}catch(e){}}}return e},o.decodeRFC2047Words=decodeRFC2047Words,o.getHeaderTokens=getHeaderTokens,o.parseAddressingHeader=function parseAddressingHeader(e,t){void 0===t&&(t=!0);let r=[],s=[],a="",n="",i="",o="",d="",c=!1,h=!1,u=!1,l=!1,p=!1,f=!1,g="";function addToAddrList(e,t){let r=t.substring(0,t.lastIndexOf("@"));if(null!==/[ !()<>[\]:;@\\,"]/.exec(r)&&(t='"'+r.replace(/([\\"])/g,"\\$1")+'"'+t.substring(t.lastIndexOf("@"))),""===(e=e.replace(/\s+/g," ").trim())&&""!==g){let t=" "===g[0]?2:1;e=g.substr(t,g.length-t-1)}""===e&&""===t||s.push({name:e,email:t}),a=i=o=g="",c=h=u=l=!1}for(let _ of getHeaderTokens(e,":,;<>@",{qstring:!0,comments:!0,dliteral:!0,rfc2047:t})){if(":"===_)n=a,a="",i="",s.length>0&&(r=r.concat(s)),s=[];else if("<"!==_||l)if(">"!==_||l)if("("===_)h=!0,p=u,u||(u=""!==a&&" "!==a.substr(-1)),d=u?" (":"(",f=!1;else{if(")"===_){h=!1,d+=")",g=d,c?u=p:(a+=d,u=!0),f=!0;continue}if("@"===_){if(l)continue;c||(o=i,a="",i="",c=!0),o+="@"}else if(","===_)addToAddrList(a,o),l=!1;else{if(";"!==_){_=cleanToken(_.toString());let e=_;u&&_&&"."!=_[0]&&(e=" "+e),h?d+=e:c?o+=e:(l||(a+=e),f?(i+=_,f=!1):i+=e),u=_&&"."!=_[0];continue}addToAddrList(a,o),""===n?r=r.concat(s):r.push({name:n,group:s}),s=[],n=""}}else c=!1,g="",l=!0;else c?(o.length>0&&(a=o),i=o=""):c=!0;u=!1}return addToAddrList(a,o),""!==n&&(r.push({name:n,group:s}),s=[]),r.concat(s)},o.parseDateHeader=function parseDateHeader(e){let t=getHeaderTokens(e,",:",{}).map((e=>e.toString()));if(t.length>1&&","===t[1]&&(t=t.slice(2)),t.length<8)return new Date(NaN);let r=parseInt(t[0]),a=parseInt(t[2]),n=parseInt(t[3]),i=parseInt(t[5]),o=parseInt(t[7]),c=s.indexOf(t[1].slice(0,3));c<0&&(c=NaN),a<100&&(a+=a<50?2e3:1900);let h=t[8];h in d&&(h=d[h]);let u=/^([+-])(\d\d)(\d\d)$/.exec(h);null===u&&(u=["+0000","+","00","00"]);let l=60*parseInt(u[2])+parseInt(u[3]);return"-"==u[1]&&(l=-l),new Date(Date.UTC(a,c,r,n,i,o)-60*l*1e3)},o.parseParameterHeader=function headerParser_parseParameterHeader(e,t,r){var s=e.indexOf(";");let a,n;s<0?(a=e,n=""):(a=e.substring(0,s),n=e.substring(s)),a=a.trim().split(/[ \t\r\n]/)[0];let i={qstring:!0,rfc2047:t},o="",d=!0,c=[];for(let e of getHeaderTokens(n,";=",i))";"===e?(""==o||d||c.push([o,""]),o="",d=!0):"="===e?d=!1:d&&""==o?o=e.toString():d||""==o?d&&(o=""):(e=e.toString(),r&&o.endsWith("*")&&(e=e.replace(/%([0-9A-Fa-f]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))}))),c.push([o,e]),o="");""==o||d||c.push([o,""]);var h=new Map,u=new Map,l=new Map;for(let e of c){let t=e[0],r=e[1],s=t.indexOf("*");if(-1==s)h.has(t)||h.set(t,r);else if(s==t.length-1)t=t.substring(0,s),u.has(t)||u.set(t,r);else{let e=t.substring(0,s),a=l.get(e);if(l.has(e)&&!a.valid)continue;l.has(e)||(a=[],a.valid=!0,a.hasCharset=void 0,l.set(e,a));let n="*"==t[t.length-1],i=t.substring(s+1,t.length-(n?1:0));if("0"==i)a.hasCharset=n;else if(0==i.length||"0"==i[0]&&"0"!=i||!/^[0-9]+$/.test(i)){a.valid=!1;continue}if(i=parseInt(i,10),void 0!==a[i]){a.valid=!1;continue}a[i]=r}}var p=new Map;for(let e of h)p.set(e[0],e[1]);if(r){for(let e of l){let t=e[0],r=e[1];if(void 0===r.hasCharset)continue;let s=!0;for(var f=0;s&&f<r.length;f++)void 0===r[f]&&(s=!1);let a=r.slice(0,f).join("");if(r.hasCharset)try{a=decode2231Value(a)}catch(e){continue}p.set(t,a)}for(let e of u)try{p.set(e[0],decode2231Value(e[1]))}catch(e){}}return p.preSemi=a,p},o.parseStructuredHeader=function parseStructuredHeader(e,t){if(("string"==typeof t||t instanceof String)&&(t=[t]),!Array.isArray(t))throw new TypeError("Header value is not an array: "+t);let r=e.toLowerCase();if(c.has(r))return c.get(r).call(o,t);throw new Error("Unknown structured header: "+e)};const u=Object.freeze(o);function StructuredHeaders(e,t){let r=e.split(/(?:\r\n|\n)(?![ \t])|\r(?![ \t\n])/);r.length>0&&"From "==r[0].substring(0,5)&&(r.shift(),e=0==r.length?"":e.substring(e.indexOf(r[0])));let s=new Map;for(let e=0;e<r.length;e++){let a,n,i=r[e].indexOf(":");i>=0?(a=r[e].substring(0,i),n=r[e].substring(i+1).trim(),t.stripcontinuations&&(n=n.replace(/[\r\n]/g,""))):(a=r[e],n=""),a=a.trim().toLowerCase(),""!=a&&(s.has(a)?s.get(a).push(n):s.set(a,[n]))}this._rawHeaders=s,this._cachedHeaders=new Map,Object.defineProperty(this,"rawHeaderText",{get:()=>e}),Object.defineProperty(this,"size",{get(){return this._rawHeaders.size}}),Object.defineProperty(this,"charset",{get(){return this._charset},set(e){this._charset=e,this._cachedHeaders.clear()}}),this._charset="charset"in t?t.charset:null,Object.defineProperty(this,"contentType",{configurable:!0,get(){return this.get("Content-Type")}})}StructuredHeaders.prototype.getRawHeader=function(e){return this._rawHeaders.get(e.toLowerCase())},StructuredHeaders.prototype.get=function(e){if(e=e.toLowerCase(),this._cachedHeaders.has(e))return this._cachedHeaders.get(e);let t=this._rawHeaders.get(e);if(void 0===t)return t;let r,s=this.charset;t=t.map((function(e){return u.convert8BitHeader(e,s)}));try{r=u.parseStructuredHeader(e,t)}catch(e){r=t.map((function(e){return u.decodeRFC2047Words(e)}))}return this._cachedHeaders.set(e,r),r},StructuredHeaders.prototype.has=function(e){return this._rawHeaders.has(e.toLowerCase())};var l="function"==typeof Symbol?Symbol.iterator:"@@iterator";function MimeParser(e,t){if(this._emitter=e,this._options={pruneat:"",bodyformat:"nodecode",strformat:"binarystring",stripcontinuations:!0,charset:"","force-charset":!1,onerror:()=>{}},t)for(var r in t)this._options[r]=t[r];if("function"!=typeof this._options.onerror)throw new Error("onerror callback must be a function");this.resetParser()}function conditionToEndOnCRLF(e){let t=e.lastIndexOf("\r",e.length-2),r=e.lastIndexOf("\n"),s=r>t?r:t;return[e.substring(0,s+1),e.substring(s+1)]}StructuredHeaders.prototype[l]=function*(){for(let e of this.keys())yield[e,this.get(e)]},StructuredHeaders.prototype.forEach=function(e,t){for(let[r,s]of this)e.call(t,s,r,this)},StructuredHeaders.prototype.entries=StructuredHeaders.prototype[Symbol.iterator],StructuredHeaders.prototype.keys=function*(){for(let t of this._rawHeaders.keys())yield i.get(t)||(e=t,e.replace(/\b[a-z]/g,(function(e){return e.toUpperCase()})));var e},StructuredHeaders.prototype.values=function*(){for(let[,e]of this)yield e},MimeParser.prototype.resetParser=function(){this._state=p,this._holdData="",this._headerData="",this._triggeredCall=!1,this._splitRegex=this._handleSplit=void 0,this._subparser=this._subPartNum=void 0,this._savedBuffer="",this._convertData=void 0,this._decoder=void 0},MimeParser.prototype.deliverData=function(e){this._holdData&&(e=this._holdData+e,this._holdData=""),e.length>0&&([e,this._holdData]=conditionToEndOnCRLF(e)),0!=e.length&&(this._triggeredCall||(this._callEmitter("startMessage"),this._triggeredCall=!0),this._dispatchData("",e,!0))},MimeParser.prototype.deliverEOF=function(){this._triggeredCall||(this._triggeredCall=!0,this._callEmitter("startMessage")),this._holdData&&this._dispatchData("",this._holdData,!0),this._dispatchEOF(""),this._callEmitter("endMessage")},MimeParser.prototype._callEmitter=function(e,...t){if(this._emitter&&e in this._emitter){if(t.length>0&&this._willIgnorePart(t[0]))return;try{this._emitter[e].apply(this._emitter,t)}catch(e){this._options.onerror(e)}}},MimeParser.prototype._willIgnorePart=function(e){if(this._options.pruneat){let t=this._options.pruneat;if(e.substr(0,t.length)!=t||t.length<e.length&&!"$.".includes(e[t.length]))return!0}return!1};var p=1;MimeParser.prototype._dispatchData=function(e,t,r){if(this._state==p){this._headerData+=t;let r=/(?:^(?:\r\n|[\r\n]))|(\r\n|[\r\n])\1/.exec(this._headerData);if(null==r)return;{let s=this._headerData.substr(0,r.index);t=this._headerData.substring(r.index+r[0].length),this._headerData=s,this._headers=this._parseHeaders(),this._callEmitter("startPart",e,this._headers),this._startBody(e)}}if(r&&this._splitRegex){let r=this._splitRegex.exec(t);if(r){let s=r.index,a=r[0].length;return s>0&&this._dispatchData(e,t.substr(0,s),!1),this._handleSplit(e,r),void((t=t.substring(s+a)).length>0&&this._dispatchData(e,t,!0))}}if(2==this._state);else if(3==this._state){if(!("none"!=this._options.bodyformat)||this._willIgnorePart(e))return;const{coerced:r,raw:s}=this._applyDataConversion(t,this._options.strformat);this._callEmitter("deliverPartData",e,r,s)}else if(4==this._state){const{coerced:e}=this._applyDataConversion(t,"binarystring");t.length>0&&this._subparser._dispatchData(this._subPartNum,e,!0)}},MimeParser.prototype._applyDataConversion=function(e,t){return this._convertData&&(e=this._savedBuffer+e,[e,this._savedBuffer]=this._convertData(e,!0)),{coerced:this._coerceData(e,t,!1),raw:e instanceof Uint8Array?e:stringToUint8Array(e)}},MimeParser.prototype._coerceData=function(e,t,r){if("string"==typeof e){if("binarystring"==t)return e;var s=stringToUint8Array(e);return"unicode"==t?this._coerceData(s,"unicode",r):s}if("binarystring"==t)return uint8ArrayToString(e);if("unicode"==t)return this._decoder?this._decoder.decode(e,{stream:r}):e;throw new Error("Invalid type: "+t)},MimeParser.prototype._dispatchEOF=function(e){if(this._state==p)this._headers=this._parseHeaders(),this._callEmitter("startPart",e,this._headers);else if(4==this._state)this._convertData&&this._savedBuffer&&this._subparser._dispatchData(this._subPartNum,this._convertData(this._savedBuffer,!1)[0],!0),this._subparser._dispatchEOF(this._subPartNum),this._subparser=null;else if(this._convertData&&this._savedBuffer){let[t]=this._convertData(this._savedBuffer,!1);t=this._coerceData(t,this._options.strformat,!1),t.length>0&&this._callEmitter("deliverPartData",e,t)}this._callEmitter("endPart",e)},MimeParser.prototype._parseHeaders=function(){let e=new StructuredHeaders(this._headerData,this._options),t=e.get("Content-Type");void 0===t?(t=u.parseStructuredHeader("Content-Type",this._defaultContentType||"text/plain"),Object.defineProperty(e,"contentType",{get:()=>t})):Object.defineProperty(e,"contentType",{configurable:!1});let r="";return r=this._options["force-charset"]?this._options.charset:t.has("charset")?t.get("charset"):this._options.charset,e.charset=r,this._charset=r,e},MimeParser.prototype._startBody=function(e){let t=this._headers.contentType;if("raw"!=this._options.bodyformat||e!=this._options.pruneat){if("multipart"==t.mediatype){if(!t.has("boundary"))return void(this._state=2);this._splitRegex=new RegExp("(\r\n|[\r\n]|^)--"+t.get("boundary").replace(/[\\^$*+?.()|{}[\]]/g,"\\$&")+"(--)?[ \t]*(?:\r\n|[\r\n]|$)"),this._handleSplit=this._whenMultipart,this._subparser=new MimeParser(this._emitter,this._options),"digest"==t.subtype&&(this._subparser._defaultContentType="message/rfc822"),this._state=2,this._convertData=function(e,t){let r=e.length;t&&("\n"==e.charAt(r-1)&&r--,r>=0&&"\r"==e.charAt(r-1)&&r--);let s=conditionToEndOnCRLF(e.substring(0,r));return[s[0],s[1]+e.substring(r)]}}else if("message/rfc822"==t.type||"message/global"==t.type||"message/news"==t.type){this._state=4,this._subPartNum=e+"$",this._subparser=new MimeParser(this._emitter,this._options);let t=this._extractHeader("content-transfer-encoding","");t in f&&(this._convertData=f[t])}else if(this._state=3,"decode"==this._options.bodyformat){let e=this._extractHeader("content-transfer-encoding","");e in f&&(this._convertData=f[e])}if("unicode"==this._options.strformat&&"text"==t.mediatype){if(this._decoder=null,""!==this._charset)try{this._decoder=new MimeTextDecoder(this._charset)}catch(e){console.error(e)}this._decoder||(this._decoder={decode:e=>MimeParser.prototype._coerceData(e,"binarystring",!0)})}else this._decoder=null}else this._state=3},MimeParser.prototype._whenMultipart=function(e,t){if(""!=e&&(e+="."),this._subPartNum){if(""!=this._savedBuffer&&""===t[1]){let e=this._savedBuffer.length-1;"\n"==this._savedBuffer[e]&&e--,e>=0&&"\r"==this._savedBuffer[e]&&e--,this._savedBuffer=this._savedBuffer.substring(0,e+1)}""!=this._savedBuffer&&this._subparser._dispatchData(this._subPartNum,this._savedBuffer,!0),this._subparser._dispatchEOF(this._subPartNum)}else this._count=1;this._savedBuffer="",null==t[2]?(this._subparser.resetParser(),this._state=4,this._subPartNum=e+this._count,this._count+=1):(this._splitRegex=null,this._state=2)},MimeParser.prototype._extractHeader=function(e,t){return e=e.toLowerCase(),this._headers.has(e)?this._headers.get(e):u.parseStructuredHeader(e,[t])};var f={};f["quoted-printable"]=decode_qp,f.base64=decode_base64;const g=MimeParser;var _={getAttachmentName(e){if(!e||!e.headers)return"";if(e.headers["content-disposition"]){let t=D.getParameter(e.headers["content-disposition"][0],"filename");if(t)return t}if(e.headers["content-type"]){let t=D.getParameter(e.headers["content-type"][0],"name");if(t)return t}return""},isAttachment(e){if(!e)return!1;let t=e.contentType||"text/plain";if(0===t.search(/^multipart\//i))return!1;let r="";return Array.isArray(e.headers["content-disposition"])&&e.headers["content-disposition"].length>0&&(r=e.headers["content-disposition"][0]),0===r.search(/^attachment/i)||-1===t.search(/^text\/plain|^text\/html|^text\/enriched/i)},startMessage(){this.mimeTree={partName:"",contentType:"message/rfc822",parts:[],size:0,headers:{},rawHeaderText:"",allAttachments:[],bodyParts:{text:[],html:[]},isEncrypted:!1},this.partsPath=[this.mimeTree],this.options=this.options||{}},endMessage(){this.mimeMsg=null,0!=this.mimeTree.parts.length&&(this.options.getMimePart?this.mimeTree.parts[0].partName==this.options.getMimePart&&(this.mimeMsg=this.mimeTree.parts[0],this.mimeMsg.bodyAsTypedArray=stringToUint8Array(this.mimeMsg.body)):this.mimeMsg=this.mimeTree)},startPart(e,t){let r=new TextEncoder,s=t.contentType&&t.contentType.type?t.contentType.type:"text/plain",a=t.rawHeaderText,n={};for(let[e,s]of t._rawHeaders){let t=Array.isArray(s)?s:[s];n[e]=t.map((e=>uint8ArrayToString(r.encode(e))))}let i=this.partsPath[this.partsPath.length-1],o="1"+(""!==e?".":"")+e;"1"==o&&(i.rawHeaderText=a,a=a.split(/\n(?![ \t])/).filter((e=>e.toLowerCase().startsWith("content-"))).join("\n").trim(),i.headers=n,n=Object.fromEntries(Object.entries(n).filter((e=>e[0].startsWith("content-"))))),n["content-type"]||(n["content-type"]=["text/plain"]);let d={partName:o,rawBody:null,body:"",headers:n,rawHeaderText:a,contentType:s,size:0,parts:[],isEncrypted:!1};i.parts.push(d),this.partsPath.push(d)},endPart(e){let t=!1,r=this.partsPath[this.partsPath.length-1],s=r.body.length;if(r.size+=s,this.isAttachment(r)){r.fileName=this.getAttachmentName(r);const e=r.headers["content-disposition"]&&r.headers["content-disposition"][0],s=r.headers["content-id"]&&r.headers["content-id"][0];r.contentDisposition=e?e.split(";").shift():void 0,r.contentId=s||void 0,this.options.includeAttachments?this.mimeTree.allAttachments.push(r):t=!0}else if(r.rawBody){delete r.rawBody;switch(r.contentType||"text/plain"){case"text/html":this.mimeTree.bodyParts.html.push(r.body);break;case"text/plain":this.mimeTree.bodyParts.text.push(r.body)}}t&&(delete r.body,delete r.rawBody),r.headers=Object.fromEntries(Object.entries(r.headers).filter((e=>!["content-disposition","content-transfer-encoding"].includes(e[0])))),this.partsPath.pop(),r=this.partsPath[this.partsPath.length-1],r.size+=s},deliverPartData(e,t,r){let s=this.partsPath[this.partsPath.length-1];s.body+="string"==typeof t?t:uint8ArrayToString(t),null===s.rawBody?s.rawBody=r:s.rawBody=function concatUint8Arrays(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++){if(!(e[r]instanceof Uint8Array))throw new Error("concatArrays: Data must be in the form of a Uint8Array");t+=e[r].length}const r=new Uint8Array(t);let s=0;return e.forEach((e=>{r.set(e,s),s+=e.length})),r}([s.rawBody,r])}},m={startPart(e,t){""==e&&(this.headers=t)}},y={body:"",startPart:m.startPart,deliverPartData(e,t){""==e&&(this.body+=t)}};const D={getParameter(e,t){t=t.toLowerCase(),e=e.replace(/[\r\n]+[ \t]+/g,"");let r=u.parseParameterHeader(";"+e,!0,!0);for(let[e,s]of r.entries())if(t==e.toLowerCase())return s;return""},parseSync(e,t,r){if("string"!=typeof e)throw new Error("input is not a recognizable type!");var s=new g(t,r);s.deliverData(e),s.deliverEOF()},makeParser:(e,t)=>new g(e,t),extractMimeMsg(e,t={}){var r=Object.create(_);r.options={includeAttachments:!0,getMimePart:""};for(let e of Object.keys(t))r.options[e]=t[e];return D.parseSync(e,r,{pruneat:r.options.getMimePart.split(".").slice(1).join("."),bodyformat:"decode",stripcontinuations:!0,strformat:"unicode"}),r.mimeMsg},extractHeaders(e){var t=Object.create(m);return D.parseSync(e,t,{pruneat:"",bodyformat:"none"}),t.headers},extractHeadersAndBody(e){var t=Object.create(y);return D.parseSync(e,t,{pruneat:"",bodyformat:"raw"}),[t.headers,t.body]},HEADER_UNSTRUCTURED:0,HEADER_PARAMETER:2,HEADER_ADDRESS:3,HEADER_OPTION_DECODE_2231:16,HEADER_OPTION_DECODE_2047:32,HEADER_OPTION_ALLOW_RAW:64,HEADER_OPTION_ALL_I18N:112,parseHeaderField(e,t,r){switch(t&D.HEADER_OPTION_ALLOW_RAW&&(e=u.convert8BitHeader(e,r)),15&t){case D.HEADER_UNSTRUCTURED:return t&D.HEADER_OPTION_DECODE_2047&&(e=u.decodeRFC2047Words(e)),e;case D.HEADER_PARAMETER:return u.parseParameterHeader(e,0!=(t&D.HEADER_OPTION_DECODE_2047),0!=(t&D.HEADER_OPTION_DECODE_2231));case D.HEADER_ADDRESS:return u.parseAddressingHeader(e,0!=(t&D.HEADER_OPTION_DECODE_2047));default:throw new Error("Illegal type of header field")}}};function parseMail(e){const t="string"==typeof e?(new TextEncoder).encode(e):e,{headers:r,allAttachments:s,bodyParts:a}=D.extractMimeMsg(uint8ArrayToString(t)),n=new Set(["message-id","content-id","from","sender","in-reply-to","reply-to","subject","date","content-disposition","content-type","content-transfer-encoding","priority","mime-version","content-description","precedence","errors-to"]),i={headers:r,attachments:s.map((({parts:e,partName:t,body:r,isEncrypted:s,rawBody:a,...n})=>({...n,content:a||new Uint8Array}))),body:{html:a.html.length?a.html.join("<br>\n").replace(/\r?\n/g,"\n"):null,text:a.text.length?a.text.join("\n").replace(/\r?\n/g,"\n"):null}};return["subject","date","to","from","to","cc","bcc","message-id","in-reply-to","reply-to"].forEach((e=>{if(!r[e])return;const t=r[e]&&u.parseStructuredHeader(e,r[e]);i[e]=n.has(e)&&Array.isArray(t)?t[t.length-1]:t})),i}}}]);
//# sourceMappingURL=chunk.65.js.map